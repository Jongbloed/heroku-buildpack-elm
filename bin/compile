#!/usr/bin/env bash

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

indent() {
  sed -u 's/^/       /'
}


restore_cache() {
  if [ -e "$BUILD_DIR/elm-stuff" ]; then
    echo "- skipping cache restore, exists" | indent
  else
    if [ -e "$CACHE_DIR/elm-stuff" ]; then
      echo "- restoring cache" | indent
      mv "$CACHE_DIR/elm-stuff" "$BUILD_DIR"
    else
      echo "- no cache detected" | indent
    fi
  fi
}

#install_binaries() {
  # cd "$BUILD_DIR" && elm install | indent
#}

make_app() {
  # node_modules should already be on the path
  ELM_COMPILE=$(cat "$ENV/ELM_COMPILE")
  echo "-----> Compiling with ${ELM_COMPILE}"
  cd "$BUILD_DIR" && $ELM_COMPILE | indent
}

cache_build() {
  ls -a 
  ls -a $BUILD_DIR
  cp -R "$BUILD_DIR/elm-stuff" "$CACHE_DIR"
  
}

#${ELM_COMPILE} | indent

#restore_cache
#install_binaries
make_app
#cache_build #TODO figure out where elm-stuff goes
