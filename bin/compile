#!/usr/bin/env bash

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

indent() {
  sed -u 's/^/       /'
}

restore_cache() {
  if [ -e "$BUILD_DIR/elm-stuff" ]; then
    echo "- skipping cache restore, exists" | indent
  else
    if [ -e "$CACHE_DIR/elm-stuff" ]; then
      echo "- restoring cache" | indent
      mv "$CACHE_DIR/elm-stuff" "$BUILD_DIR"
    else
      echo "- no cache detected" | indent
    fi
  fi
}

#install_binaries() {
  # cd "$BUILD_DIR" && elm install | indent
#}

make_app() {
  # node_modules should already be on the path
  # ELM_COMPILE=$(get_app_json_env "ELM_COMPILE" || "elm make *.elm --output App.js")
  cd "$BUILD_DIR" && $ELM_COMPILE | indent
}

cache_build() {
  ls -a 
  ls -a $BUILD_DIR
  cp -R "$BUILD_DIR/elm-stuff" "$CACHE_DIR"
  
}


restore_cache
#install_binaries
make_app
cache_build
